<div class="module-card">
  <h3>ğŸ§¾ Invoice Generator</h3>
  <input id="invClient" placeholder="Client name" />
  <div class="form-row">
    <input id="item_name" placeholder="Item name" />
    <input id="item_qty" type="number" placeholder="Qty" />
    <input id="item_price" type="number" placeholder="Unit price" />
    <button id="addItem" class="btn">â• Add</button>
  </div>

  <table id="invoiceTable"><thead><tr><th>Item</th><th>Qty</th><th>Price</th><th>Total</th><th>Action</th></tr></thead><tbody id="invoiceBody"></tbody></table>

  <div class="module-actions">
    <div class="small muted">Invoice Total: â‚¦<span id="invoiceTotal">0</span></div>
    <button id="downloadPDF" class="btn">ğŸ“¥ Download PDF</button>
    <button id="exportInvoiceCSV" class="btn">â¬‡ï¸ Export CSV</button>
    <button id="resetInvoice" class="btn">ğŸ”„ Reset</button>
  </div>
</div>

<script>
(function init_invoice(){
  let items = JSON.parse(localStorage.getItem('mod_invoice')||'[]');
  const body = document.getElementById('invoiceBody'), totalEl = document.getElementById('invoiceTotal');

  function render(){ body.innerHTML = items.map((it,i)=>`<tr><td>${it.name}</td><td>${it.qty}</td><td>${it.price}</td><td>${it.qty*it.price}</td><td><button onclick="delInvItem(${i})">Delete</button></td></tr>`).join(''); totalEl.innerText = items.reduce((s,it)=>s+it.qty*it.price,0); }

  window.delInvItem = function(i){ items.splice(i,1); save(); }
  function save(){ localStorage.setItem('mod_invoice', JSON.stringify(items)); render(); }

  document.getElementById('addItem').addEventListener('click', ()=>{ const n=document.getElementById('item_name').value, q=Number(document.getElementById('item_qty').value||0), p=Number(document.getElementById('item_price').value||0); if(!n) return alert('Enter item'); items.push({name:n,qty:q,price:p}); save(); });

  document.getElementById('exportInvoiceCSV').addEventListener('click', ()=>{ if(!items.length) return alert('No data'); const csv='Item,Qty,Price,Total\\n'+items.map(i=>`${i.name},${i.qty},${i.price},${i.qty*i.price}`).join('\\n'); const b=new Blob([csv],{type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download='invoice.csv'; a.click(); });

  document.getElementById('downloadPDF').addEventListener('click', ()=>{ // simple print PDF via jsPDF or print window
    window.print();
  });

  document.getElementById('resetInvoice').addEventListener('click', ()=>{ if(confirm('Reset invoice?')){ items=[]; save(); }});
  render();
})();
</script>
